<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dois Corpos - Planejador de Casamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap');

        /* --- THEME --- */
        :root {
            --color-emerald-dark: #064E3B;
            --color-emerald-main: #10B981;
            --color-gold: #D4AF37;
            --color-bg: #F9FAFB;
        }

        body { font-family: 'Lato', sans-serif; background-color: var(--color-bg); color: #374151; }
        h1, h2, h3, h4, .serif-font { font-family: 'Playfair Display', serif; }
        .decorative-font { font-family: 'Cinzel', serif; }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }

        /* --- COMPONENTS --- */
        .btn-primary {
            background: linear-gradient(135deg, #065f46 0%, #047857 100%);
            color: white; transition: all 0.3s ease; box-shadow: 0 4px 6px -1px rgba(6, 78, 59, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-1px); box-shadow: 0 6px 8px -1px rgba(6, 78, 59, 0.4);
        }
        
        .nav-item { position: relative; color: #6B7280; transition: color 0.3s; }
        .nav-item.active { color: #065f46; font-weight: 700; }
        .nav-item.active::after {
            content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px; background-color: var(--color-gold);
        }

        .card { 
            background-color: white; border: 1px solid #E5E7EB; border-radius: 12px; 
            box-shadow: 0 2px 4px -1px rgba(0,0,0,0.02); transition: transform 0.2s, box-shadow 0.2s; 
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); border-color: #D1D5DB; }

        .input-elegant { 
            border: 1px solid #E5E7EB; border-radius: 8px; padding: 0.6rem; background-color: #F9FAFB; transition: all 0.2s;
        }
        .input-elegant:focus { 
            outline: none; border-color: var(--color-gold); background-color: white; box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1); 
        }

        /* --- TAGS STYLING --- */
        .tag-selector-pill { 
            font-size: 11px; padding: 4px 10px; border-radius: 999px; border: 1px solid #E5E7EB; 
            cursor: pointer; user-select: none; transition: all 0.2s; 
            background: white; color: #6B7280; display: inline-flex; items-center; margin-right: 4px; margin-bottom: 4px;
        }
        .tag-selector-pill:hover { border-color: var(--color-emerald-main); transform: translateY(-1px); }
        .tag-selector-pill.selected { border-width: 2px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); background-color: #ECFDF5; color: #065F46; border-color: #10B981; }

        .task-tag-visible {
            display: inline-block; font-size: 10px; padding: 2px 8px; border-radius: 999px; 
            color: white; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15); margin-top: 4px; margin-right: 4px;
        }

        .color-swatch { -webkit-appearance: none; border: none; width: 30px; height: 30px; cursor: pointer; padding: 0; background: none; }
        .color-swatch::-webkit-color-swatch-wrapper { padding: 0; }
        .color-swatch::-webkit-color-swatch { border: none; border-radius: 50%; border: 1px solid #ddd; }

        .countdown-box { background: rgba(6, 78, 59, 0.03); border-radius: 8px; padding: 8px 4px; min-width: 50px; text-align: center; }
        .countdown-val { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 1.5rem; line-height: 1; color: var(--color-emerald-dark); }
        .countdown-label { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 1px; color: #9CA3AF; margin-top: 2px; }

        .task-section-header { 
            font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; 
            margin-top: 1.5rem; margin-bottom: 0.75rem; padding-bottom: 0.25rem; border-bottom: 1px solid #E5E7EB;
            color: #9CA3AF; display: flex; justify-content: space-between; align-items: center;
        }
        .task-section-header.urgent { color: #EF4444; border-color: #FECACA; }
        .task-section-header.today { color: #D97706; border-color: #FDE68A; }
        .task-section-header.week { color: #059669; border-color: #A7F3D0; }

        /* --- VENDOR COMPARE STYLES --- */
        .vendor-score-circle {
            width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.3rem; border: 3px solid; font-family: 'Playfair Display', serif;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .score-high { border-color: #10B981; color: #065F46; background: #ECFDF5; }
        .score-med { border-color: #FBBF24; color: #92400E; background: #FFFBEB; }
        .score-low { border-color: #EF4444; color: #991B1B; background: #FEF2F2; }
        
        .score-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; border-top: 1px solid #E5E7EB; padding-top: 8px; margin-top: 8px; }
        .score-item { text-align: center; border-radius: 4px; padding: 2px; background: #F9FAFB; }
        .score-item span { display: block; font-size: 8px; text-transform: uppercase; color: #6B7280; letter-spacing: 0.5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .score-item b { font-size: 11px; color: #374151; font-weight: 800; }
        
        .price-badge { background-color: #F0FDFA; color: #047857; padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 0.9rem; border: 1px solid #A7F3D0; }
        .vendor-category-header {
            font-family: 'Cinzel', serif; font-size: 1.1rem; color: #064E3B; border-bottom: 2px solid #D1FAE5; margin-bottom: 1rem; padding-bottom: 0.5rem; margin-top: 2rem;
        }

        /* --- MODALS --- */
        #edit-modal, #view-modal, #vendor-modal { background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
        #login-overlay { background-color: #F0FDFA; background-image: radial-gradient(#E0E7FF 1px, transparent 1px); background-size: 20px 20px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- LOGIN SCREEN -->
    <div id="login-overlay" class="fixed inset-0 z-[100] flex flex-col items-center justify-center p-4 transition-opacity duration-500">
        <div class="max-w-md w-full bg-white p-8 rounded-2xl shadow-2xl text-center border-t-4 border-emerald-800 relative">
            <div class="mb-6">
                <canvas id="logo-login" width="100" height="70" class="mx-auto mb-4"></canvas>
                <h1 class="text-3xl decorative-font text-emerald-900 mb-1">Dois Corpos</h1>
                <div class="h-0.5 w-12 bg-yellow-400 mx-auto mb-2"></div>
                <p class="text-stone-500 text-xs uppercase tracking-widest">Gestão de Casamento</p>
            </div>
            
            <div id="auth-form" class="space-y-4 text-left">
                <input type="email" id="email" class="input-elegant w-full" placeholder="Email">
                <input type="password" id="password" class="input-elegant w-full" placeholder="Senha">
                <p id="auth-error" class="text-red-500 text-xs h-4 text-center font-bold"></p>
                <button onclick="handleAuth()" id="btn-auth" class="btn-primary w-full py-2.5 rounded-lg font-bold text-sm uppercase tracking-wide">Entrar</button>
                <div class="text-center mt-4 pt-3 border-t border-stone-100">
                    <button onclick="toggleAuthMode()" class="text-xs font-bold text-emerald-700 hover:text-emerald-900 underline" id="toggle-btn">Criar conta nova</button>
                </div>
            </div>
            <div id="auth-loading" class="hidden py-6"><p class="text-emerald-800 text-sm animate-pulse">Conectando...</p></div>
        </div>
    </div>

    <!-- VIEW TASK MODAL -->
    <div id="view-modal" class="fixed inset-0 z-[95] hidden flex items-center justify-center p-4">
        <div class="bg-white p-0 rounded-xl shadow-2xl w-full max-w-md border border-stone-100 overflow-hidden animate-fade-in relative">
            <div class="h-3 bg-gradient-to-r from-emerald-600 to-emerald-400"></div>
            <button onclick="closeViewModal()" class="absolute top-4 right-4 text-stone-400 hover:text-stone-600 bg-white rounded-full p-1"><i class="fa-solid fa-times"></i></button>
            <div class="p-8">
                <span id="view-category" class="text-[10px] font-bold text-emerald-600 uppercase tracking-widest bg-emerald-50 px-2 py-1 rounded mb-2 inline-block">Categoria</span>
                <h3 id="view-title" class="text-2xl font-serif text-stone-800 mb-2 leading-tight">Título</h3>
                <div class="flex items-center text-stone-500 text-sm mb-4">
                    <i class="fa-regular fa-calendar mr-2"></i><span id="view-date">Data</span>
                </div>
                <div id="view-tags" class="flex flex-wrap gap-1 mb-6"></div>
                <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-200">
                    <h4 class="text-xs font-bold text-stone-400 uppercase mb-1">Observações</h4>
                    <p id="view-obs" class="text-sm text-stone-700 whitespace-pre-wrap italic">Nenhuma observação.</p>
                </div>
                <div class="mt-8 flex justify-end">
                    <button id="view-edit-btn" class="text-xs font-bold text-stone-500 hover:text-emerald-700 flex items-center"><i class="fa-solid fa-pencil mr-1"></i> Editar Tarefa</button>
                </div>
            </div>
        </div>
    </div>

    <!-- VENDOR COMPARE MODAL -->
    <div id="vendor-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-3xl border-t-4 border-emerald-600 animate-fade-in max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-serif text-emerald-900 mb-4">Novo Fornecedor</h3>
            
            <div class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-stone-400">Nome do Fornecedor</label>
                        <input type="text" id="vend-name" placeholder="Ex: Espaço Villa Real" class="input-elegant w-full">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase font-bold text-stone-400">Categoria (Define Critérios)</label>
                        <select id="vend-cat" class="input-elegant w-full" onchange="checkVendorTemplate()">
                            <option value="" disabled selected>Selecione...</option>
                            <option>Espaço</option><option>Buffet</option><option>Decoração</option><option>Som e música</option>
                            <option>Iluminação</option><option>Taxas</option><option>Bolo</option><option>Extras</option>
                            <option>Fotografia / Filmagem</option><option>Cerimonial</option><option>Convites</option><option>Doces</option>
                            <option>Lembrancinhas</option><option>Noiva</option><option>Noivo</option><option>Beleza</option>
                            <option>Beleza extra</option><option>Papelaria</option><option>Imprevistos</option><option>Cartório</option>
                            <option>Aliança</option><option>Apartamento</option><option>Reserva Investimento</option><option>Primeira Compra</option>
                            <option>Básico (Luz/Água...)</option><option>Viagem</option><option>Enxoval</option>
                        </select>
                    </div>
                </div>

                <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100 flex items-center justify-between">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-emerald-700">Valor Total (R$)</label>
                        <input type="number" id="vend-value" placeholder="0,00" class="input-elegant w-full font-bold text-emerald-800 text-lg border-emerald-300">
                    </div>
                    <div class="text-right max-w-[50%]">
                         <label class="text-[10px] uppercase font-bold text-stone-500 block mb-1">Copiar Critérios De:</label>
                         <select id="copy-criteria-select" class="input-elegant text-xs w-full" onchange="copyCriteriaFrom()">
                             <option value="">-- Padrão da Categoria --</option>
                             <!-- Populated JS -->
                         </select>
                    </div>
                </div>

                <div class="p-5 bg-stone-50 rounded-lg border border-stone-100">
                    <div class="flex justify-between items-center mb-3">
                         <p class="text-xs font-bold text-stone-500 uppercase">Critérios de Avaliação (0 a 10)</p>
                         <button onclick="addCustomCriterion()" class="text-[10px] text-emerald-600 font-bold hover:underline">+ Adicionar Critério</button>
                    </div>
                    
                    <div id="custom-criteria-list" class="space-y-2">
                        <p class="text-xs text-stone-400 italic">Selecione uma categoria acima para carregar critérios.</p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-2 mt-6 border-t pt-4">
                <button onclick="closeVendorModal()" class="px-4 py-2 text-sm text-stone-500 hover:bg-stone-100 rounded">Cancelar</button>
                <button onclick="saveVendor()" class="btn-primary px-6 py-2 rounded text-sm font-bold">Salvar</button>
            </div>
        </div>
    </div>

    <!-- GENERIC EDIT MODAL -->
    <div id="edit-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-lg border-t-4 border-emerald-600 animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-serif text-emerald-900">Editar / Detalhes</h3>
                <button onclick="closeModal()" class="text-stone-400 hover:text-stone-600"><i class="fa-solid fa-times"></i></button>
            </div>
            <div id="modal-content" class="space-y-4"></div>
            <div class="flex justify-end gap-2 mt-6 pt-4 border-t border-stone-100">
                <button onclick="closeModal()" class="px-4 py-2 text-sm text-stone-500 hover:bg-stone-100 rounded">Cancelar</button>
                <button id="modal-save-btn" class="btn-primary px-6 py-2 rounded text-sm font-bold">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- APP HEADER -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3">
                    <canvas id="logo-header" width="40" height="30"></canvas>
                    <div>
                        <span class="text-lg text-emerald-900 font-bold decorative-font block leading-none">Dois Corpos</span>
                        <span id="connection-status" class="text-[9px] uppercase font-bold text-stone-400">Offline</span>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <button onclick="switchTab('dashboard')" class="nav-item active text-xs uppercase font-bold tracking-widest py-2">Visão Geral</button>
                    <button onclick="switchTab('budget')" class="nav-item text-xs uppercase font-bold tracking-widest py-2">Orçamento</button>
                    <button onclick="switchTab('compare')" class="nav-item text-xs uppercase font-bold tracking-widest py-2">Comparador</button>
                    <button onclick="switchTab('guests')" class="nav-item text-xs uppercase font-bold tracking-widest py-2">Convidados</button>
                    <button onclick="switchTab('timeline')" class="nav-item text-xs uppercase font-bold tracking-widest py-2">Tarefas</button>
                </nav>
                <button onclick="handleLogout()" class="text-xs text-stone-400 hover:text-red-500"><i class="fa-solid fa-sign-out-alt"></i> Sair</button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- DASHBOARD -->
        <section id="dashboard" class="space-y-8 animate-fade-in">
            <div class="text-center">
                <h2 class="text-3xl text-emerald-900 serif-font italic">Painel do Casal</h2>
            </div>

            <!-- Global Settings -->
            <div class="flex justify-center">
                 <div class="bg-white p-3 rounded-lg shadow border border-stone-100 flex flex-col md:flex-row items-center gap-3">
                     <div class="flex items-center gap-2 px-2">
                         <span class="text-xs font-bold text-emerald-800 uppercase"><i class="fa-regular fa-calendar mr-1"></i> Data:</span>
                         <input type="date" id="wedding-date-input" class="bg-stone-50 border border-stone-200 rounded p-1.5 text-sm text-stone-700 focus:outline-none focus:border-emerald-500">
                     </div>
                     <div class="flex items-center gap-2 px-2">
                         <span class="text-xs font-bold text-emerald-800 uppercase"><i class="fa-regular fa-clock mr-1"></i> Hora:</span>
                         <input type="time" id="wedding-time-input" class="bg-stone-50 border border-stone-200 rounded p-1.5 text-sm text-stone-700 focus:outline-none focus:border-emerald-500">
                     </div>
                     <div class="flex items-center gap-2 px-2 border-l border-stone-100">
                         <span class="text-xs font-bold text-emerald-800 uppercase">Orçamento R$:</span>
                         <input type="number" id="total-budget-input" class="bg-stone-50 border border-stone-200 rounded p-1.5 w-28 text-sm text-stone-700 focus:outline-none focus:border-emerald-500">
                     </div>
                     <button onclick="saveGlobalSettings()" class="bg-emerald-800 text-white text-xs font-bold px-4 py-2 rounded hover:bg-emerald-700 transition ml-2 shadow-sm">
                         <i class="fa-solid fa-save mr-1"></i> Salvar
                     </button>
                 </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Count -->
                <div class="card p-6 border-t-4 border-rose-300">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs font-bold text-stone-400 uppercase tracking-widest">Contagem Regressiva</h3>
                        <i class="fa-regular fa-heart text-rose-300"></i>
                    </div>
                    <div class="flex justify-center items-center gap-2">
                        <div class="countdown-box"><span class="countdown-val" id="cd-days">00</span><div class="countdown-label">Dias</div></div>
                        <span class="text-stone-300 text-xl font-serif">:</span>
                        <div class="countdown-box"><span class="countdown-val" id="cd-hours">00</span><div class="countdown-label">Horas</div></div>
                        <span class="text-stone-300 text-xl font-serif">:</span>
                        <div class="countdown-box"><span class="countdown-val" id="cd-mins">00</span><div class="countdown-label">Min</div></div>
                        <span class="text-stone-300 text-xl font-serif">:</span>
                        <div class="countdown-box"><span class="countdown-val" id="cd-secs">00</span><div class="countdown-label">Seg</div></div>
                    </div>
                </div>
                <!-- Budget -->
                <div class="card p-6 border-t-4 border-emerald-400">
                    <h3 class="text-xs font-bold text-stone-400 uppercase tracking-widest">Orçamento Gasto</h3>
                    <div class="mt-2 flex items-baseline justify-between">
                        <span class="text-3xl serif-font text-emerald-700" id="dash-budget-percent">0%</span>
                        <span class="text-stone-500 text-xs" id="dash-budget-left">Disponível: R$ 0</span>
                    </div>
                    <div class="w-full bg-stone-100 h-1.5 mt-4 rounded-full overflow-hidden">
                        <div id="dash-progress-bar" class="bg-emerald-500 h-full w-0 transition-all duration-1000"></div>
                    </div>
                </div>
                <!-- Guests -->
                <div class="card p-6 border-t-4 border-blue-300">
                    <h3 class="text-xs font-bold text-stone-400 uppercase tracking-widest">Resumo Convidados</h3>
                    <div class="mt-2 flex flex-col space-y-2">
                        <div class="flex items-baseline justify-between">
                            <div><span class="text-4xl serif-font text-blue-900 mr-2" id="dash-total-pax">0</span><span class="text-stone-500 text-sm">pessoas (total)</span></div>
                            <div class="text-right"><span class="text-xl font-bold text-green-600 block leading-none" id="dash-guest-confirmed">0</span><span class="text-[10px] text-stone-400 uppercase">Confirmados</span></div>
                        </div>
                        <div class="flex items-baseline pt-2 border-t border-stone-100">
                            <span class="text-lg font-bold text-stone-600 mr-2" id="dash-invites-count">0</span><span class="text-stone-400 text-xs uppercase">Convites (Famílias/Grupos)</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VENDOR COMPARE -->
        <section id="compare" class="hidden space-y-6 animate-fade-in">
            <div class="flex justify-between items-end border-b border-stone-200 pb-2">
                <div><h2 class="text-2xl font-serif text-emerald-900">Comparador de Fornecedores</h2><p class="text-xs text-stone-500 uppercase tracking-wider">Use os padrões ou copie de outros</p></div>
                <button onclick="openVendorModal()" class="bg-stone-700 text-white px-4 py-2 rounded text-xs font-bold hover:bg-stone-800 shadow-sm">+ Avaliar Novo</button>
            </div>
            <div id="vendor-list-container"></div>
        </section>

        <!-- BUDGET -->
        <section id="budget" class="hidden space-y-6 animate-fade-in">
            <h2 class="text-2xl font-serif text-emerald-900 border-b border-stone-200 pb-2">Controle Financeiro</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-4">
                    <div class="card p-4 bg-emerald-50 border-emerald-100">
                        <h4 class="text-xs font-bold text-emerald-800 uppercase mb-2">Novo Gasto</h4>
                        <div class="flex gap-2">
                            <select id="new-exp-cat" class="input-elegant text-xs w-1/3">
                                <option value="" disabled selected>Categoria</option><option>Buffet & Comida</option><option>Local</option><option>Foto & Vídeo</option><option>Decoração</option><option>Música/DJ</option><option>Vestido/Beleza</option><option>Doces/Bolo</option><option>Assessoria</option><option>Outros</option>
                            </select>
                            <input type="number" id="new-exp-val" placeholder="Valor R$" class="input-elegant text-xs flex-grow">
                            <button onclick="addExpense()" class="bg-emerald-600 text-white px-4 rounded text-xs font-bold hover:bg-emerald-700">Adicionar</button>
                        </div>
                    </div>
                    <div class="card overflow-hidden"><table class="w-full text-left"><thead class="bg-stone-50 text-xs font-bold text-stone-500 uppercase"><tr><th class="p-3">Item</th><th class="p-3 text-right">Valor</th><th class="p-3 text-center">Ações</th></tr></thead><tbody id="budget-list-body" class="text-sm divide-y divide-stone-100"></tbody></table></div>
                </div>
                <div class="space-y-4">
                    <div class="card p-6 text-center"><div class="chart-container h-40"><canvas id="budgetChart"></canvas></div><p class="mt-4 text-xs font-bold text-stone-400 uppercase">Saldo Disponível</p><p class="text-xl font-serif text-emerald-600 font-bold" id="budget-balance-display">R$ 0</p></div>
                    <div id="savings-tips" class="card p-4 bg-yellow-50 border-yellow-200 text-xs text-stone-700 space-y-2"></div>
                </div>
            </div>
        </section>

        <!-- GUESTS -->
        <section id="guests" class="hidden space-y-6 animate-fade-in">
            <h2 class="text-2xl font-serif text-emerald-900 border-b border-stone-200 pb-2">Convidados</h2>
            <div class="card p-4 bg-white shadow-sm border border-emerald-100">
                <div class="grid grid-cols-12 gap-3 items-end">
                    <div class="col-span-12 sm:col-span-5"><label class="text-[10px] font-bold text-stone-400 uppercase">Nome Principal</label><input type="text" id="new-guest-name" class="input-elegant w-full text-sm"></div>
                    <div class="col-span-6 sm:col-span-2"><label class="text-[10px] font-bold text-stone-400 uppercase">+ Acomp.</label><input type="number" id="new-guest-partners" value="0" min="0" class="input-elegant w-full text-sm"></div>
                    <div class="col-span-6 sm:col-span-5"><label class="text-[10px] font-bold text-stone-400 uppercase mb-1 block">Tags (Selecione)</label><div class="flex flex-wrap gap-1" id="guest-tags-selector"><span onclick="toggleTag(this)" class="tag-selector-pill">Padrinho</span><span onclick="toggleTag(this)" class="tag-selector-pill">Madrinha</span><span onclick="toggleTag(this)" class="tag-selector-pill">Família</span><span onclick="toggleTag(this)" class="tag-selector-pill">Amigos</span><span onclick="toggleTag(this)" class="tag-selector-pill">Fornecedor</span><span onclick="toggleTag(this)" class="tag-selector-pill">Deu Presente</span></div></div>
                    <div class="col-span-12 mt-2"><button onclick="addGuest()" class="btn-primary w-full py-2 rounded text-sm font-bold">Salvar Convidado</button></div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1 space-y-4">
                    <div class="card p-4 h-fit"><h4 class="font-bold text-emerald-800 text-sm mb-3">Estatísticas</h4><div class="space-y-3 text-sm text-stone-600"><div class="flex justify-between border-b border-stone-100 pb-1"><span>Convites:</span> <b id="stats-invites">0</b></div><div class="flex justify-between border-b border-stone-100 pb-1"><span>Total de Pessoas:</span> <b id="stats-total-pax" class="text-blue-800 text-lg">0</b></div><div class="flex justify-between text-green-600 pt-1"><span>Confirmados:</span> <b id="stats-confirmed">0</b></div></div><div class="mt-4 h-32"><canvas id="guestChart"></canvas></div></div>
                    <div class="card p-4 h-fit border-l-4 border-indigo-200"><h4 class="font-bold text-indigo-900 text-sm mb-3">Por Categoria (Pessoas)</h4><div id="guest-tags-report" class="space-y-2 text-xs"><p class="text-stone-400 italic">Adicione tags para ver o relatório.</p></div></div>
                </div>
                <div class="md:col-span-2 card overflow-hidden"><div class="overflow-y-auto max-h-[600px] custom-scroll"><table class="w-full text-left"><thead class="bg-stone-50 sticky top-0 text-xs font-bold text-stone-500 uppercase"><tr><th class="p-3">Nome</th><th class="p-3">Pax</th><th class="p-3">Tags</th><th class="p-3">Status</th><th class="p-3 text-right"></th></tr></thead><tbody id="guest-list-body" class="text-sm divide-y divide-stone-100"></tbody></table></div></div>
            </div>
        </section>

        <!-- TASKS -->
        <section id="timeline" class="hidden space-y-6 animate-fade-in">
            <h2 class="text-2xl font-serif text-emerald-900 border-b border-stone-200 pb-2">Tarefas</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 h-fit sticky top-24">
                    <div class="card p-4 bg-stone-50">
                        <h4 class="text-xs font-bold text-stone-500 uppercase mb-3">Nova Tarefa</h4>
                        <input type="text" id="new-task-input" placeholder="Título da tarefa..." class="input-elegant w-full mb-2 text-sm">
                        <select id="new-task-cat" class="input-elegant w-full mb-2 text-sm"><option value="Geral">Geral</option><option value="Cerimônia">Cerimônia</option><option value="Festa/Buffet">Festa/Buffet</option><option value="Burocracia">Burocracia</option><option value="Trajes/Beleza">Trajes/Beleza</option><option value="Lua de Mel">Lua de Mel</option><option value="Buffet & Comida">Buffet & Comida</option><option value="Local">Local</option><option value="Foto & Vídeo">Foto & Vídeo</option><option value="Decoração">Decoração</option><option value="Música/DJ">Música/DJ</option><option value="Doces/Bolo">Doces/Bolo</option><option value="Assessoria">Assessoria</option></select>
                        <input type="date" id="new-task-date" class="input-elegant w-full mb-2 text-sm">
                        <textarea id="new-task-obs" placeholder="Observações (opcional)..." class="input-elegant w-full mb-2 text-sm h-20 resize-none"></textarea>
                        <div class="mb-3"><label class="text-[10px] font-bold text-stone-400 uppercase">Tags</label><div class="flex flex-wrap gap-1 mt-1" id="task-quick-tags"></div><button onclick="toggleTagCreator()" class="text-xs text-emerald-600 hover:underline mt-1">+ Criar Tag</button><div id="tag-creator" class="hidden mt-2 p-2 bg-white rounded border border-emerald-200 shadow-sm"><input type="text" id="new-tag-name" placeholder="Nome da Tag" class="text-xs border p-1 rounded w-full mb-1"><div class="flex items-center gap-2"><input type="color" id="new-tag-color" value="#10B981" class="color-swatch"><button onclick="createNewTag()" class="text-xs bg-emerald-600 text-white px-2 py-1 rounded">Salvar</button></div></div></div>
                        <button onclick="addTask()" class="bg-stone-700 text-white w-full py-2 rounded text-sm font-bold hover:bg-stone-800">Adicionar Tarefa</button>
                    </div>
                </div>
                <div class="lg:col-span-2 card p-4 overflow-hidden"><div id="tasks-list" class="space-y-4"></div></div>
            </div>
        </section>

        <!-- TOOLS -->
        <section id="tools" class="hidden space-y-6 animate-fade-in">
            <h2 class="text-2xl font-serif text-emerald-900">Calculadora</h2>
            <div class="card p-6 border-t-4 border-yellow-400">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-4"><input type="number" id="calc-guests" value="100" class="input-elegant w-full" oninput="calculateDrinks()" placeholder="Qtd. Convidados"><select id="calc-profile" class="input-elegant w-full" onchange="calculateDrinks()"><option value="moderate">Cerveja + Refri</option><option value="high">Cerveja + Destilados</option><option value="low">Brunch/Leve</option></select></div>
                    <div class="md:col-span-2 grid grid-cols-2 gap-4 text-center"><div class="p-3 bg-stone-50 rounded border"><span class="text-2xl font-bold block" id="res-beer">0</span><span class="text-[10px] uppercase">Latas Cerveja</span></div><div class="p-3 bg-stone-50 rounded border"><span class="text-2xl font-bold block" id="res-water">0</span><span class="text-[10px] uppercase">Água</span></div><div class="p-3 bg-stone-50 rounded border"><span class="text-2xl font-bold block" id="res-soda">0</span><span class="text-[10px] uppercase">Refri 2L</span></div><div class="p-3 bg-stone-50 rounded border"><span class="text-2xl font-bold block" id="res-sparkling">0</span><span class="text-[10px] uppercase">Espumante</span></div></div>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithCustomToken, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, deleteDoc, updateDoc, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        function drawLogo(id) {
            const canvas = document.getElementById(id);
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            ctx.clearRect(0,0,w,h);
            ctx.lineWidth = 2.5; ctx.strokeStyle = '#D4AF37'; // Gold
            ctx.beginPath(); ctx.arc(w/2 - 8, h/2, 12, 0, Math.PI*2); ctx.stroke();
            ctx.beginPath(); ctx.arc(w/2 + 8, h/2, 12, 0, Math.PI*2); ctx.stroke();
        }
        window.addEventListener('load', () => { drawLogo('logo-login'); drawLogo('logo-header'); });

        const firebaseConfig = {
            apiKey: "AIzaSyBbd5GSe2dAOuDPFy3K3h6r53Op9y1iFbw",
            authDomain: "doiscorpos-2f241.firebaseapp.com",
            projectId: "doiscorpos-2f241",
            storageBucket: "doiscorpos-2f241.firebasestorage.app",
            messagingSenderId: "924599762554",
            appId: "1:924599762554:web:5a61ad6d21580a74a105c3"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;
        let isRegistering = false;
        
        const getAppId = () => typeof __app_id !== 'undefined' ? __app_id : 'doiscorpos-default';
        const getUserRoot = () => currentUser ? `artifacts/${getAppId()}/users/${currentUser.uid}` : null;

        window.toggleAuthMode = () => {
            isRegistering = !isRegistering;
            document.getElementById('btn-auth').innerText = isRegistering ? "Cadastrar & Entrar" : "Entrar";
            document.getElementById('toggle-btn').innerText = isRegistering ? "Já tenho conta" : "Criar conta nova";
        };

        window.handleAuth = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const err = document.getElementById('auth-error');
            const btn = document.getElementById('btn-auth');
            
            if(!email || !pass) { err.innerText = "Preencha tudo."; return; }
            btn.disabled = true; btn.innerText = "Processando...";

            try {
                if(isRegistering) await createUserWithEmailAndPassword(auth, email, pass);
                else await signInWithEmailAndPassword(auth, email, pass);
            } catch(e) {
                console.error(e);
                let msg = "Erro desconhecido.";
                if(e.code.includes('password')) msg = "Senha errada/fraca.";
                if(e.code.includes('user-not-found')) msg = "Usuário não existe.";
                if(e.code.includes('email-already-in-use')) msg = "Email já usado.";
                err.innerText = msg;
                btn.disabled = false; btn.innerText = isRegistering ? "Cadastrar" : "Entrar";
            }
        };

        window.handleLogout = async () => { await signOut(auth); location.reload(); };

        const init = async () => {
            if(typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    if(typeof __firebase_config !== 'undefined' && JSON.parse(__firebase_config).projectId === firebaseConfig.projectId) {
                        document.getElementById('auth-form').classList.add('hidden');
                        document.getElementById('auth-loading').classList.remove('hidden');
                        await signInWithCustomToken(auth, __initial_auth_token);
                    }
                } catch(e) { console.warn("Auto-login fallback"); }
            }
        };
        init();

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('login-overlay').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('connection-status').innerText = "ONLINE";
                document.getElementById('connection-status').className = "text-[9px] uppercase font-bold text-green-600";
                setupListeners();
            } else {
                document.getElementById('login-overlay').classList.remove('opacity-0', 'pointer-events-none');
                document.getElementById('auth-form').classList.remove('hidden');
                document.getElementById('auth-loading').classList.add('hidden');
            }
        });

        const handleDbError = (err) => {
            console.error("DB Error:", err);
            if(err.code === 'permission-denied') {
                alert("ERRO DE PERMISSÃO!\n\nO Firebase bloqueou a escrita. Vá ao Console > Firestore > Rules e mude para:\nallow read, write: if request.auth != null;");
            } else {
                alert("Erro ao salvar: " + err.message);
            }
        };

        let state = { budget: [], guests: [], tasks: [], customTags: [], vendors: [], settings: {} };

        function setupListeners() {
            const root = getUserRoot();
            if(!root) return;

            onSnapshot(doc(db, root, 'settings', 'general'), (snap) => {
                if(snap.exists()) {
                    const d = snap.data();
                    state.settings = d; 
                    document.getElementById('wedding-date-input').value = d.date || '';
                    document.getElementById('wedding-time-input').value = d.time || '';
                    document.getElementById('total-budget-input').value = d.budgetTotal || '';
                    updateUI(d);
                    startCountdown(); 
                }
            }, (err) => console.warn("Read settings error", err));

            onSnapshot(collection(db, root, 'expenses'), s => {
                state.budget = []; s.forEach(d => state.budget.push({id: d.id, ...d.data()})); updateUI();
            });
            onSnapshot(collection(db, root, 'guests'), s => {
                state.guests = []; s.forEach(d => state.guests.push({id: d.id, ...d.data()})); updateUI();
            });
            onSnapshot(collection(db, root, 'tasks'), s => {
                state.tasks = []; s.forEach(d => state.tasks.push({id: d.id, ...d.data()})); updateUI();
            });
            onSnapshot(collection(db, root, 'custom_tags'), s => {
                state.customTags = []; 
                s.forEach(d => state.customTags.push({id: d.id, ...d.data()})); 
                renderTagSelectors(); 
            });
            onSnapshot(collection(db, root, 'vendors'), s => {
                state.vendors = [];
                s.forEach(d => state.vendors.push({id: d.id, ...d.data()}));
                renderVendorList();
                updateCopyDropdown();
            });
        }

        let timerInterval = null;
        function startCountdown() {
            if(timerInterval) clearInterval(timerInterval);
            const run = () => {
                if(!state.settings.date) return;
                const [y, m, d] = state.settings.date.split('-');
                let targetDate = new Date(y, m-1, d);
                if(state.settings.time) {
                    const [th, tm] = state.settings.time.split(':');
                    targetDate.setHours(th, tm, 0);
                } else { targetDate.setHours(0,0,0); }

                const now = new Date();
                let diff = targetDate - now;
                if (diff < 0) diff = 0;

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                const elD = document.getElementById('cd-days');
                const elH = document.getElementById('cd-hours');
                const elM = document.getElementById('cd-mins');
                const elS = document.getElementById('cd-secs');

                if(elD) elD.innerText = String(days).padStart(2, '0');
                if(elH) elH.innerText = String(hours).padStart(2, '0');
                if(elM) elM.innerText = String(minutes).padStart(2, '0');
                if(elS) elS.innerText = String(seconds).padStart(2, '0');
            };
            run(); timerInterval = setInterval(run, 1000);
        }

        window.toggleTagCreator = () => { document.getElementById('tag-creator').classList.toggle('hidden'); }

        window.createNewTag = async () => {
            const name = document.getElementById('new-tag-name').value;
            const color = document.getElementById('new-tag-color').value;
            if(name) {
                try {
                    await addDoc(collection(db, getUserRoot(), 'custom_tags'), { name, color, timestamp: serverTimestamp() });
                    document.getElementById('new-tag-name').value = '';
                    document.getElementById('tag-creator').classList.add('hidden');
                } catch(e) { handleDbError(e); }
            }
        }

        function renderTagSelectors() {
            const quickTags = document.getElementById('task-quick-tags');
            if(quickTags) {
                quickTags.innerHTML = '';
                state.customTags.forEach(tag => {
                    const el = document.createElement('span');
                    el.className = 'tag-selector-pill';
                    el.innerText = tag.name;
                    el.style.borderLeft = `3px solid ${tag.color}`;
                    el.onclick = function() { this.classList.toggle('selected'); };
                    el.dataset.tagObj = JSON.stringify(tag); 
                    quickTags.appendChild(el);
                });
            }
        }

        window.saveGlobalSettings = async () => {
            if(!getUserRoot()) return;
            const date = document.getElementById('wedding-date-input').value;
            const time = document.getElementById('wedding-time-input').value;
            const budgetTotal = parseFloat(document.getElementById('total-budget-input').value) || 0;
            try {
                await setDoc(doc(db, getUserRoot(), 'settings', 'general'), { date, time, budgetTotal }, { merge: true });
                alert("Configurações salvas com sucesso!");
            } catch(e) { handleDbError(e); }
        };

        async function addItem(coll, data) { try { await addDoc(collection(db, getUserRoot(), coll), { ...data, timestamp: serverTimestamp() }); } catch(e) { handleDbError(e); } }
        async function updateItem(coll, id, data) { try { await updateDoc(doc(db, getUserRoot(), coll, id), data); } catch(e) { handleDbError(e); } }
        async function deleteItem(coll, id) { if(!confirm("Excluir item?")) return; try { await deleteDoc(doc(db, getUserRoot(), coll, id)); } catch(e) { handleDbError(e); } }

        window.addExpense = () => {
            const cat = document.getElementById('new-exp-cat').value;
            const val = parseFloat(document.getElementById('new-exp-val').value);
            if(cat && val) { addItem('expenses', { category: cat, amount: val }); document.getElementById('new-exp-val').value = ''; }
        };
        window.deleteExpense = (id) => deleteItem('expenses', id);

        window.addGuest = () => {
            const name = document.getElementById('new-guest-name').value;
            const partners = parseInt(document.getElementById('new-guest-partners').value) || 0;
            const tags = [];
            document.querySelectorAll('#guest-tags-selector .tag-selector-pill.selected').forEach(el => tags.push(el.innerText));
            if(name) {
                addItem('guests', { name, partners, tags, status: 'pending' });
                document.getElementById('new-guest-name').value = '';
                document.querySelectorAll('.tag-selector-pill.selected').forEach(el => el.classList.remove('selected'));
            }
        };
        window.deleteGuest = (id) => deleteItem('guests', id);
        window.toggleTag = (el) => el.classList.toggle('selected');
        window.updateGuestStatus = (id, val) => updateItem('guests', id, { status: val });

        window.addTask = () => {
            const text = document.getElementById('new-task-input').value;
            const cat = document.getElementById('new-task-cat').value;
            const date = document.getElementById('new-task-date').value;
            const obs = document.getElementById('new-task-obs').value;
            const selectedTags = [];
            document.querySelectorAll('#task-quick-tags .tag-selector-pill.selected').forEach(el => {
                selectedTags.push(JSON.parse(el.dataset.tagObj));
            });

            if(text) {
                addItem('tasks', { text, category: cat, deadline: date, done: false, observation: obs, tags: selectedTags });
                document.getElementById('new-task-input').value = '';
                document.getElementById('new-task-obs').value = '';
                document.querySelectorAll('#task-quick-tags .tag-selector-pill.selected').forEach(el => el.classList.remove('selected'));
            }
        };
        window.toggleTask = (id, current) => updateItem('tasks', id, { done: !current });
        window.deleteTask = (id) => deleteItem('tasks', id);

        window.viewTask = (id) => {
            const task = state.tasks.find(t => t.id === id);
            if(!task) return;
            document.getElementById('view-category').innerText = task.category || 'Geral';
            document.getElementById('view-title').innerText = task.text;
            if(task.deadline) {
                const [y, m, d] = task.deadline.split('-');
                document.getElementById('view-date').innerText = `${d}/${m}/${y}`;
            } else { document.getElementById('view-date').innerText = 'Sem data'; }
            
            const tagContainer = document.getElementById('view-tags');
            tagContainer.innerHTML = '';
            if(task.tags && task.tags.length > 0) {
                task.tags.forEach(t => {
                    tagContainer.innerHTML += `<span class="text-[10px] px-2 py-1 rounded bg-stone-100 border border-stone-200" style="border-left: 3px solid ${t.color}">${t.name}</span>`;
                });
            } else { tagContainer.innerHTML = '<span class="text-xs text-stone-300 italic">Sem tags</span>'; }

            const obsEl = document.getElementById('view-obs');
            if(task.observation) { obsEl.innerText = task.observation; obsEl.classList.remove('italic', 'text-stone-400'); } 
            else { obsEl.innerText = 'Nenhuma observação registrada.'; obsEl.classList.add('italic', 'text-stone-400'); }

            document.getElementById('view-edit-btn').onclick = () => { closeViewModal(); openEditModal('tasks', id); };
            document.getElementById('view-modal').classList.remove('hidden');
        };
        window.closeViewModal = () => document.getElementById('view-modal').classList.add('hidden');

        // VENDOR LOGIC
        const vendorCategories = [
            "Espaço", "Buffet", "Decoração", "Som e música", "Iluminação", "Taxas", "Bolo", "Extras",
            "Fotografia / Filmagem", "Cerimonial", "Convites", "Doces", "Lembrancinhas", "Noiva", "Noivo",
            "Beleza", "Beleza extra", "Papelaria", "Imprevistos", "Cartório", "Aliança", "Apartamento",
            "Reserva Investimento", "Primeira Compra", "Básico (Luz/Água...)", "Viagem", "Enxoval"
        ];

        // Mapped Default Criteria for Standard Categories
        const standardCriteria = {
            "Espaço": ["Localização", "Capacidade", "Ar Condicionado", "Beleza", "Infraestrutura"],
            "Buffet": ["Sabor", "Variedade", "Apresentação", "Bebidas", "Serviço"],
            "Decoração": ["Criatividade", "Flores", "Acervo", "Projeto", "Preço"],
            "Som e música": ["Repertório", "Equipamento", "Animação", "Iluminação", "Preço"],
            "Fotografia / Filmagem": ["Estilo", "Edição", "Prazos", "Equipe", "Álbuns"],
            "Cerimonial": ["Organização", "Experiência", "Equipe", "Indicações", "Preço"]
        };

        window.openVendorModal = () => {
            const container = document.getElementById('vend-cat-container');
            // Check if element exists before modifying
            if(container) {
                // If using the old container for checkboxes (removed in this version)
            }
            
            // Populate category select
            const catSelect = document.getElementById('vend-cat');
            if(catSelect && catSelect.options.length <= 1) {
                // Keep default
                vendorCategories.forEach(c => {
                   const opt = document.createElement('option');
                   opt.value = c; opt.innerText = c;
                   catSelect.appendChild(opt);
                });
            }

            // Clear inputs
            document.getElementById('vend-name').value = '';
            document.getElementById('vend-value').value = '';
            document.getElementById('vend-cat').value = '';
            document.getElementById('custom-criteria-list').innerHTML = '<p class="text-xs text-stone-400 italic">Selecione uma categoria acima para carregar critérios.</p>';
            
            updateCopyDropdown();
            document.getElementById('vendor-modal').classList.remove('hidden');
        }

        window.closeVendorModal = () => document.getElementById('vendor-modal').classList.add('hidden');

        // Logic: When category selected in Dropdown
        window.checkVendorTemplate = () => {
            const cat = document.getElementById('vend-cat').value;
            const list = document.getElementById('custom-criteria-list');
            list.innerHTML = ''; // Clear always on new selection to show fresh template
            
            if (standardCriteria[cat]) {
                standardCriteria[cat].forEach(cName => {
                     addCustomCriterion(cName);
                });
            } else {
                // Generic default
                ["Qualidade", "Atendimento", "Preço", "Prazos", "Contrato"].forEach(c => addCustomCriterion(c));
            }
        };
        
        window.updateCopyDropdown = () => {
            const sel = document.getElementById('copy-criteria-select');
            if(!sel) return;
            // Keep default option
            sel.innerHTML = '<option value="">-- Copiar de Outro --</option>';
            state.vendors.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v.id;
                opt.innerText = v.name;
                sel.appendChild(opt);
            });
        };

        window.copyCriteriaFrom = () => {
            const sel = document.getElementById('copy-criteria-select');
            const targetId = sel.value;
            if(!targetId) return;
            
            const targetVendor = state.vendors.find(v => v.id === targetId);
            if(targetVendor && targetVendor.scores) {
                const list = document.getElementById('custom-criteria-list');
                list.innerHTML = ''; // Clear current
                Object.keys(targetVendor.scores).forEach(cName => {
                     addCustomCriterion(cName);
                });
            }
        };

        window.addCustomCriterion = (prefillName = '') => {
             const list = document.getElementById('custom-criteria-list');
             // Remove placeholder text if exists
             if(list.children.length > 0 && list.children[0].tagName === 'P') list.innerHTML = '';
             
             const div = document.createElement('div');
             div.className = "flex gap-2 items-center mb-2 criterion-row";
             div.innerHTML = `
                <input type="text" placeholder="Nome do Critério" class="input-elegant w-2/3 text-xs p-1 crit-name" value="${prefillName}">
                <input type="number" placeholder="Nota" min="0" max="10" class="input-elegant w-1/3 text-center p-1 font-bold crit-score" onchange="limitInput(this)">
                <button onclick="this.parentElement.remove()" class="text-stone-300 hover:text-red-500 text-xs">✕</button>
             `;
             list.appendChild(div);
        };

        window.limitInput = (el) => {
            if(el.value > 10) el.value = 10;
            if(el.value < 0) el.value = 0;
        }
        
        window.saveVendor = () => {
            const name = document.getElementById('vend-name').value;
            const cat = document.getElementById('vend-cat').value;
            const val = parseFloat(document.getElementById('vend-value').value)||0;
            
            if(!name || !cat) {
                alert("Preencha o nome e selecione a categoria.");
                return;
            }

            const rows = document.querySelectorAll('.criterion-row');
            let scores = {};
            
            rows.forEach(row => {
                const cName = row.querySelector('.crit-name').value;
                const cScore = parseInt(row.querySelector('.crit-score').value) || 0;
                if(cName) scores[cName] = cScore;
            });
            
            addItem('vendors', { 
                name, category: cat, monetaryValue: val, scores 
            });
            
            closeVendorModal();
        };

        window.deleteVendor = (id) => deleteItem('vendors', id);

        function renderVendorList() {
            const list = document.getElementById('vendor-list-container');
            if(!list) return;
            list.innerHTML = '';
            
            if(state.vendors.length === 0) {
                list.innerHTML = `<p class="text-center text-stone-400 col-span-full py-8">Nenhum fornecedor comparado ainda.</p>`;
                return;
            }

            const groups = {};
            state.vendors.forEach(v => {
                // Single Category logic now
                const primary = v.category || 'Outros';
                if(!groups[primary]) groups[primary] = [];
                groups[primary].push(v);
            });

            Object.keys(groups).sort().forEach(catName => {
                const group = groups[catName];
                
                let minP = Infinity, maxP = -Infinity;
                group.forEach(v => {
                    if(v.monetaryValue < minP) minP = v.monetaryValue;
                    if(v.monetaryValue > maxP) maxP = v.monetaryValue;
                });

                const processed = group.map(v => {
                    const scoreValues = Object.values(v.scores || {});
                    const qualAvg = scoreValues.length > 0 ? scoreValues.reduce((a,b)=>a+b,0)/scoreValues.length : 0;
                    
                    let priceScore = 0;
                    if(v.monetaryValue === 0) priceScore = 0;
                    else if(maxP === minP) priceScore = 10;
                    else priceScore = 10 * (1 - ((v.monetaryValue - minP) / (maxP - minP)));
                    
                    // Final Score
                    const totalItems = scoreValues.length + 1; // +1 for price
                    const finalScore = totalItems > 0 ? ((qualAvg * scoreValues.length) + priceScore) / totalItems : 0;
                    
                    return { ...v, priceScore, finalScore, qualAvg };
                });

                processed.sort((a,b) => b.finalScore - a.finalScore);

                const header = document.createElement('div');
                header.className = "vendor-category-header";
                header.innerText = catName;
                list.appendChild(header);

                const grid = document.createElement('div');
                grid.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8";
                
                processed.forEach(v => {
                    let scoreClass = 'score-low';
                    if(v.finalScore >= 8) scoreClass = 'score-high'; else if(v.finalScore >= 5) scoreClass = 'score-med';
                    const priceVal = v.monetaryValue.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
                    
                    let critHtml = '';
                    const entries = Object.entries(v.scores || {});
                    entries.forEach(([key, val]) => {
                        critHtml += `<div class="score-item"><span>${key}</span><b>${val}</b></div>`;
                    });
                    critHtml += `<div class="score-item bg-emerald-50"><span class="text-emerald-700 font-bold">Preço (Auto)</span><b class="text-emerald-700">${v.priceScore.toFixed(1)}</b></div>`;

                    grid.innerHTML += `
                        <div class="card p-5 relative group">
                            <button onclick="deleteVendor('${v.id}')" class="absolute top-2 right-2 text-stone-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">✕</button>
                            
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="font-bold text-stone-800 text-lg leading-tight truncate" title="${v.name}">${v.name}</h3>
                                </div>
                                <div class="flex flex-col items-center ml-2">
                                    <div class="vendor-score-circle ${scoreClass}">${v.finalScore.toFixed(1)}</div>
                                    <span class="text-[9px] text-stone-400 uppercase mt-1">Média</span>
                                </div>
                            </div>
                            <div class="mb-4 bg-stone-50 p-2 rounded text-center">
                                <span class="text-sm font-bold text-emerald-800">${priceVal}</span>
                            </div>
                            <div class="score-grid" style="grid-template-columns: repeat(3, 1fr);">
                                ${critHtml}
                            </div>
                        </div>
                    `;
                });
                list.appendChild(grid);
            });
        }

        let currentEditInfo = null; 
        window.createTagInModal = async () => {
            const name = document.getElementById('modal-new-tag-name').value;
            const color = document.getElementById('modal-new-tag-color').value;
            if(name) {
                try {
                    await addDoc(collection(db, getUserRoot(), 'custom_tags'), { name, color, timestamp: serverTimestamp() });
                    document.getElementById('modal-new-tag-name').value = '';
                } catch(e) { handleDbError(e); }
            }
        }

        window.openEditModal = (coll, id) => {
            const modal = document.getElementById('edit-modal');
            const content = document.getElementById('modal-content');
            currentEditInfo = { coll, id };
            content.innerHTML = ''; 

            let item;
            if(coll === 'expenses') item = state.budget.find(x => x.id === id);
            if(coll === 'guests') item = state.guests.find(x => x.id === id);
            if(coll === 'tasks') item = state.tasks.find(x => x.id === id);

            if(!item) return;

            if(coll === 'expenses') {
                content.innerHTML = `
                    <label class="text-xs font-bold text-stone-500">Valor</label>
                    <input id="edit-val" type="number" class="input-elegant w-full mb-3" value="${item.amount}">
                    <label class="text-xs font-bold text-stone-500">Categoria</label>
                    <select id="edit-cat" class="input-elegant w-full">
                        <option value="${item.category}" selected>${item.category}</option>
                        <option>Buffet & Comida</option><option>Local</option><option>Foto & Vídeo</option>
                        <option>Decoração</option><option>Música/DJ</option><option>Outros</option>
                    </select>
                `;
            } else if(coll === 'guests') {
                const currentTags = item.tags || [];
                const allTags = ['Padrinho','Madrinha','Família','Amigos','Fornecedor','Deu Presente'];
                let tagsHtml = `<div class="flex flex-wrap gap-2 mt-2" id="edit-guest-tags">`;
                allTags.forEach(t => {
                    const isSel = currentTags.includes(t) ? 'selected' : '';
                    tagsHtml += `<span onclick="toggleTag(this)" class="tag-selector-pill ${isSel}">${t}</span>`;
                });
                tagsHtml += `</div>`;

                content.innerHTML = `
                    <label class="text-xs font-bold text-stone-500">Nome</label>
                    <input id="edit-name" type="text" class="input-elegant w-full mb-3" value="${item.name}">
                    <label class="text-xs font-bold text-stone-500">Acompanhantes</label>
                    <input id="edit-partners" type="number" class="input-elegant w-full mb-3" value="${item.partners}">
                    <label class="text-xs font-bold text-stone-500">Tags</label>
                    ${tagsHtml}
                `;
            } else if(coll === 'tasks') {
                const currentTaskTags = item.tags || [];
                let tagsHtml = `<div class="flex flex-wrap gap-1 mt-2" id="edit-task-tags">`;
                state.customTags.forEach(tag => {
                    const isSel = currentTaskTags.some(t => (t.id && t.id === tag.id) || t.name === tag.name) ? 'selected' : '';
                    tagsHtml += `<span class="tag-selector-pill ${isSel}" onclick="this.classList.toggle('selected')" data-tag-obj='${JSON.stringify(tag)}' style="border-left: 3px solid ${tag.color}">${tag.name}</span>`;
                });
                tagsHtml += `</div>`;
                
                const createTagHtml = `
                    <div class="mt-3 pt-3 border-t border-stone-100 flex items-center gap-2">
                        <input type="text" id="modal-new-tag-name" placeholder="Nova Tag..." class="text-xs border p-1 rounded w-full">
                        <input type="color" id="modal-new-tag-color" value="#10B981" class="color-swatch">
                        <button onclick="createTagInModal()" class="text-xs bg-stone-700 text-white px-2 py-1 rounded">Criar</button>
                    </div>
                `;

                content.innerHTML = `
                    <label class="text-xs font-bold text-stone-500">Descrição</label>
                    <input id="edit-text" type="text" class="input-elegant w-full mb-3" value="${item.text}">
                    <label class="text-xs font-bold text-stone-500">Categoria</label>
                    <select id="edit-cat" class="input-elegant w-full mb-3">
                        <option value="${item.category}" selected>${item.category}</option>
                        <option value="Geral">Geral</option><option value="Cerimônia">Cerimônia</option>
                        <option value="Festa/Buffet">Festa/Buffet</option>
                        <option value="Burocracia">Burocracia</option>
                        <option value="Trajes/Beleza">Trajes/Beleza</option>
                        <option value="Lua de Mel">Lua de Mel</option>
                        <option value="Buffet & Comida">Buffet & Comida</option>
                        <option value="Local">Local</option>
                        <option value="Foto & Vídeo">Foto & Vídeo</option>
                        <option value="Decoração">Decoração</option>
                        <option value="Música/DJ">Música/DJ</option>
                        <option value="Doces/Bolo">Doces/Bolo</option>
                        <option value="Assessoria">Assessoria</option>
                    </select>
                    <label class="text-xs font-bold text-stone-500">Data Limite</label>
                    <input id="edit-date" type="date" class="input-elegant w-full mb-3" value="${item.deadline}">
                    <label class="text-xs font-bold text-stone-500">Observações</label>
                    <textarea id="edit-obs" class="input-elegant w-full h-24 resize-none mb-3">${item.observation || ''}</textarea>
                    <label class="text-xs font-bold text-stone-500">Tags</label>
                    ${tagsHtml}
                    ${createTagHtml}
                `;
            }
            modal.classList.remove('hidden');
        };

        window.closeModal = () => { document.getElementById('edit-modal').classList.add('hidden'); currentEditInfo = null; };

        document.getElementById('modal-save-btn').onclick = async () => {
            if(!currentEditInfo) return;
            const { coll, id } = currentEditInfo;
            let data = {};

            if(coll === 'expenses') {
                data.amount = parseFloat(document.getElementById('edit-val').value);
                data.category = document.getElementById('edit-cat').value;
            } else if(coll === 'guests') {
                data.name = document.getElementById('edit-name').value;
                data.partners = parseInt(document.getElementById('edit-partners').value);
                const tags = [];
                document.querySelectorAll('#edit-guest-tags .tag-selector-pill.selected').forEach(el => tags.push(el.innerText));
                data.tags = tags;
            } else if(coll === 'tasks') {
                data.text = document.getElementById('edit-text').value;
                data.category = document.getElementById('edit-cat').value;
                data.deadline = document.getElementById('edit-date').value;
                data.observation = document.getElementById('edit-obs').value;
                const tags = [];
                document.querySelectorAll('#edit-task-tags .tag-selector-pill.selected').forEach(el => {
                    tags.push(JSON.parse(el.dataset.tagObj));
                });
                data.tags = tags;
            }
            await updateItem(coll, id, data);
            closeModal();
        };

        function updateUI(settings) {
            if(!settings && state.settings) settings = state.settings;
            if(!settings) { settings = { date: '', budgetTotal: 0 }; }

            if(settings.date) {
                const [y, m, d] = settings.date.split('-');
                const eventDate = new Date(y, m-1, d);
                const today = new Date(); today.setHours(0,0,0,0);
                const diff = Math.ceil((eventDate - today)/(1000*60*60*24));
                const daysEl = document.getElementById('days-count');
                if (daysEl) daysEl.innerText = diff > 0 ? diff : 0;
            }
            const spent = state.budget.reduce((a,b) => a + b.amount, 0);
            const total = settings.budgetTotal || 0;
            const pct = total > 0 ? Math.min(100, Math.round((spent/total)*100)) : 0;
            
            const pctEl = document.getElementById('dash-budget-percent');
            if(pctEl) pctEl.innerText = `${pct}%`;
            const leftEl = document.getElementById('dash-budget-left');
            if(leftEl) leftEl.innerText = `Livre: R$ ${(total-spent).toLocaleString('pt-BR')}`;
            const progEl = document.getElementById('dash-progress-bar');
            if(progEl) progEl.style.width = `${pct}%`;

            let invitesCount = state.guests.length; 
            let totalPax = 0; 
            let guestsConf = 0;

            // NEW: Aggregate Guest Tags Stats
            let tagCounts = {};

            state.guests.forEach(g => {
                const p = 1 + (parseInt(g.partners)||0);
                if(g.status !== 'declined') { totalPax += p; }
                if(g.status === 'confirmed') guestsConf += p;

                if(g.tags && Array.isArray(g.tags)) {
                    g.tags.forEach(t => {
                        tagCounts[t] = (tagCounts[t] || 0) + p;
                    });
                }
            });

            // Render Guest Tag Report
            const reportEl = document.getElementById('guest-tags-report');
            if(reportEl) {
                reportEl.innerHTML = '';
                if(Object.keys(tagCounts).length === 0) {
                    reportEl.innerHTML = '<p class="text-stone-400 italic">Nenhuma tag atribuída.</p>';
                } else {
                    Object.keys(tagCounts).forEach(tag => {
                        reportEl.innerHTML += `
                            <div class="flex justify-between items-center border-b border-stone-50 pb-1">
                                <span>${tag}</span>
                                <span class="font-bold text-indigo-700">${tagCounts[tag]}</span>
                            </div>
                        `;
                    });
                }
            }

            const invEl = document.getElementById('dash-invites-count');
            if(invEl) invEl.innerText = invitesCount;
            const paxEl = document.getElementById('dash-total-pax');
            if(paxEl) paxEl.innerText = totalPax;
            const confEl = document.getElementById('dash-guest-confirmed');
            if(confEl) confEl.innerText = `${guestsConf} Confirmados`;

            const statInvEl = document.getElementById('stats-invites');
            if(statInvEl) statInvEl.innerText = invitesCount;
            const statPaxEl = document.getElementById('stats-total-pax');
            if(statPaxEl) statPaxEl.innerText = totalPax;
            const statConfEl = document.getElementById('stats-confirmed');
            if(statConfEl) statConfEl.innerText = guestsConf;

            renderLists();
            renderCharts(spent, total, state.budget, guestsConf, totalPax);
        }

        function renderLists() {
            const bl = document.getElementById('budget-list-body');
            if(bl) {
                bl.innerHTML = '';
                state.budget.forEach(e => {
                    bl.innerHTML += `
                        <tr class="hover:bg-emerald-50 border-b border-stone-100 group">
                            <td class="p-3 font-medium text-stone-700">${e.category}</td>
                            <td class="p-3 text-right text-emerald-700 font-bold">R$ ${e.amount.toLocaleString('pt-BR')}</td>
                            <td class="p-3 text-center flex justify-end gap-2">
                                <button onclick="openEditModal('expenses', '${e.id}')" class="text-stone-400 hover:text-blue-500">✎</button>
                                <button onclick="deleteExpense('${e.id}')" class="text-stone-300 hover:text-red-500">✕</button>
                            </td>
                        </tr>
                    `;
                });
            }

            const gl = document.getElementById('guest-list-body');
            if(gl) {
                gl.innerHTML = '';
                state.guests.forEach(g => {
                    const totalInParty = 1 + (parseInt(g.partners)||0);
                    let tags = (g.tags||[]).map(t => `<span class="bg-stone-100 text-stone-500 text-[9px] px-1 rounded border mr-1">${t}</span>`).join('');
                    gl.innerHTML += `
                        <tr class="hover:bg-emerald-50 border-b border-stone-100">
                            <td class="p-3 font-bold text-stone-700">${g.name}</td>
                            <td class="p-3 text-stone-500 font-mono">${totalInParty} <span class="text-[9px] text-stone-400">(1+${g.partners})</span></td>
                            <td class="p-3">${tags}</td>
                            <td class="p-3">
                                <select onchange="updateGuestStatus('${g.id}', this.value)" class="bg-transparent text-xs font-bold ${g.status==='confirmed'?'text-emerald-600':(g.status==='declined'?'text-red-400':'text-yellow-600')}">
                                    <option value="pending" ${g.status==='pending'?'selected':''}>Pendente</option>
                                    <option value="confirmed" ${g.status==='confirmed'?'selected':''}>Confirmado</option>
                                    <option value="declined" ${g.status==='declined'?'selected':''}>Não Vai</option>
                                </select>
                            </td>
                            <td class="p-3 text-right flex justify-end gap-2">
                                <button onclick="openEditModal('guests', '${g.id}')" class="text-stone-400 hover:text-blue-500">✎</button>
                                <button onclick="deleteGuest('${g.id}')" class="text-stone-300 hover:text-red-500">✕</button>
                            </td>
                        </tr>
                    `;
                });
            }

            const tl = document.getElementById('tasks-list');
            if(tl) {
                tl.innerHTML = '';
                if(state.tasks.length === 0) {
                    tl.innerHTML = '<p class="text-center text-stone-400 text-sm py-4">Nenhuma tarefa criada.</p>';
                    return;
                }

                const buckets = { late: [], today: [], week: [], month: [], nextMonth: [], future: [], noDate: [] };
                const today = new Date(); today.setHours(0,0,0,0);
                
                const dayOfWeek = today.getDay(); 
                const distToSat = 6 - dayOfWeek;
                const endOfWeek = new Date(today);
                endOfWeek.setDate(today.getDate() + distToSat);
                endOfWeek.setHours(23,59,59,999);

                const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                const startNextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
                const endNextMonth = new Date(today.getFullYear(), today.getMonth() + 2, 0);

                const pendingTasks = state.tasks.filter(t => !t.done).sort((a,b) => {
                    if(!a.deadline) return 1; if(!b.deadline) return -1;
                    return new Date(a.deadline) - new Date(b.deadline);
                });
                const doneTasks = state.tasks.filter(t => t.done);

                pendingTasks.forEach(t => {
                    if(!t.deadline) { buckets.noDate.push(t); return; }
                    const [y, m, d] = t.deadline.split('-');
                    const taskDate = new Date(y, m-1, d); 
                    taskDate.setHours(0,0,0,0);

                    if (taskDate < today) buckets.late.push(t);
                    else if (taskDate.getTime() === today.getTime()) buckets.today.push(t);
                    else if (taskDate <= endOfWeek) buckets.week.push(t);
                    else if (taskDate <= endOfMonth) buckets.month.push(t); 
                    else if (taskDate >= startNextMonth && taskDate <= endNextMonth) buckets.nextMonth.push(t);
                    else buckets.future.push(t);
                });

                const renderBucket = (title, items, className) => {
                    if(items.length === 0) return;
                    tl.innerHTML += `<div class="task-section-header ${className}">${title} (${items.length})</div>`;
                    items.forEach(t => tl.innerHTML += createTaskHTML(t));
                };

                renderBucket('🚨 Atrasadas', buckets.late, 'urgent');
                renderBucket('🔥 Hoje', buckets.today, 'today');
                renderBucket('📅 Essa Semana', buckets.week, 'week');
                renderBucket('🗓️ Esse Mês', buckets.month, '');
                renderBucket('📆 Próximo Mês', buckets.nextMonth, '');
                renderBucket('🔮 Futuro', buckets.future, '');
                renderBucket('📝 Sem Data', buckets.noDate, '');
                
                if(doneTasks.length > 0) {
                    tl.innerHTML += `<div class="task-section-header mt-6 border-t pt-4">✅ Concluídas (${doneTasks.length})</div>`;
                    doneTasks.forEach(t => tl.innerHTML += createTaskHTML(t));
                }
            }
        }

        function createTaskHTML(t) {
            let dateTxt = '';
            if(t.deadline) {
                const [y, m, d] = t.deadline.split('-');
                dateTxt = `${d}/${m}/${y}`;
            }
            const hasObs = t.observation && t.observation.trim().length > 0;
            let tagPills = '';
            if(t.tags && Array.isArray(t.tags) && t.tags.length > 0) {
                tagPills = '<div class="mt-2 flex flex-wrap gap-1">';
                t.tags.forEach(tag => {
                    const bg = tag.color || '#10B981';
                    tagPills += `<span class="task-tag-visible" style="background-color: ${bg};">${tag.name}</span>`;
                });
                tagPills += '</div>';
            }

            return `
                <div class="flex items-start justify-between p-3 bg-white border border-stone-100 rounded-lg shadow-sm mb-2 hover:shadow-md transition ${t.done?'opacity-50 grayscale':''}">
                    <div class="flex items-start gap-3 w-full">
                        <div onclick="toggleTask('${t.id}', ${t.done})" class="w-5 h-5 mt-1 rounded-full border-2 cursor-pointer flex-shrink-0 flex items-center justify-center ${t.done?'bg-emerald-500 border-emerald-500':'border-stone-300'}">
                            ${t.done ? '<span class="text-white text-[10px]">✓</span>' : ''}
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center gap-2">
                                <p class="text-sm font-bold text-stone-700 ${t.done?'line-through text-stone-400':''}">${t.text}</p>
                                <button onclick="viewTask('${t.id}')" class="text-stone-400 hover:text-emerald-600 p-1" title="Ver Detalhes">
                                    <i class="fa-regular fa-eye"></i>
                                </button>
                            </div>
                            
                            <div class="text-[10px] text-stone-400 font-bold uppercase tracking-wider flex flex-wrap gap-2 mt-1">
                                <span>${t.category}</span>
                                ${dateTxt ? `<span>📅 ${dateTxt}</span>` : ''}
                            </div>
                            ${tagPills}
                        </div>
                    </div>
                    <div class="flex gap-2 flex-shrink-0 ml-1">
                        <button onclick="deleteTask('${t.id}')" class="text-stone-300 hover:text-red-500 text-sm px-2">✕</button>
                    </div>
                </div>
            `;
        }

        let chart1 = null, chart2 = null;
        function renderCharts(spent, total, items, gConf, gTotal) {
            const ctx1 = document.getElementById('budgetChart');
            if(ctx1 && chart1) chart1.destroy();
            if(ctx1) {
                let cats = {}; items.forEach(i => cats[i.category] = (cats[i.category]||0)+i.amount);
                const rem = Math.max(0, total - spent);
                chart1 = new Chart(ctx1, {
                    type: 'doughnut',
                    data: { labels: Object.keys(cats).concat(['Livre']), datasets: [{ data: Object.values(cats).concat([rem]), backgroundColor: ['#059669', '#0891B2', '#D97706', '#DB2777', '#7C3AED', '#E5E7EB'], borderWidth: 0 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });
                document.getElementById('budget-balance-display').innerText = "R$ " + rem.toLocaleString('pt-BR');
            }

            const ctx2 = document.getElementById('guestChart');
            if(ctx2 && chart2) chart2.destroy();
            if(ctx2) {
                const pending = gTotal - gConf; 
                chart2 = new Chart(ctx2, {
                    type: 'doughnut',
                    data: { labels: ['Confirmados', 'Pendentes'], datasets: [{ data: [gConf, pending], backgroundColor: ['#10B981', '#FCD34D'], borderWidth: 0 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 8 } } } }
                });
            }
        }

        window.calculateDrinks = () => {
             const guests = parseInt(document.getElementById('calc-guests').value)||0;
            const profile = document.getElementById('calc-profile').value;
            let b=2, w=0.8, s=0.6, sp=0.25;
            if (profile === 'high') { b=4; w=1; s=0.4; } else if (profile === 'low') { b=1.5; sp=0.4; }
            document.getElementById('res-beer').innerText = Math.ceil(guests*b);
            document.getElementById('res-water').innerText = Math.ceil(guests*w);
            document.getElementById('res-soda').innerText = Math.ceil(guests*s);
            document.getElementById('res-sparkling').innerText = Math.ceil(guests*sp);
        }

        window.switchTab = (tabId) => {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.querySelectorAll(`button[onclick="switchTab('${tabId}')"]`).forEach(b => b.classList.add('active'));
            if(tabId === 'tools') window.calculateDrinks();
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
